![Poster](https://i.imgur.com/xcIztM7.jpg "Poster")

# COVID ROYALE

Online Multiplayer Game to spread awareness about COVID-19
To play our game, please [click here to visit our homepage.](https://covid-royale.westus.cloudapp.azure.com/)

## Requirements

#### Outline

- You will require some third-party accounts to complete a full setup of this application.
- Create a mongoDB atlas account, to host a cloud based mongoDB instance that we will connect to in our application.

- Create a google Developers project, we need to tell google so to speak, that we would like to register our application to use the OAuth flow.

- Add some parameters generated by creating the above accounts, into a .ENV file, which allows our application to connect to the services we just set up.

#### Create MongoDB Atlas Account

We need to set up a MongoDB account for storage of sessions and user data.

- [Create a MongoDB Atlas account.](https://www.mongodb.com/download-center)

- [Complete steps 1 - 4 of MongoAtlas getting started.](https://docs.atlas.mongodb.com/getting-started )

- Navigate to your newly created cluster, click "Connect" > "Connect my application" > Select the Node.js driver (version 3.0 or later)

- And copy the connection string, **Save this because you will need it later.**

#### Create Google Developer Project and Authorize

Next we need to do a bit of set up with google developer console, in order to let google know we would like to enable our application, we have to create a new google project, and connect our application to it, this will allow us to verify users with OAuth authentication flow.

- Head to https://support.google.com/cloud/answer/6158849?hl=en and follow the instructions to create a new project, and set it up to allow oauth authentication.
- Once your credentials have been created, you will need to copy the clientID aswell as clientSecret and again, **save these values for later.**
- Next navigate to https://console.developers.google.com/ and find the project you just created.
- Click "credentials" Then under the heading "OAuth 2.0 Client IDs"
- Click the clientID you just created. 
- Under "Authorized Javascript origins" you must add the URI "[http://localhost:8080](http://localhost:8080/)"
- Under "Authorized redirect URI's you must add the URI "http://localhost:8080/login/google/redirected"

Once these steps are complete, continue onto Setup Instructions.

## Setup Instructions

#### Integrated Development Environment

The only requirements that you will need for this is capable IDE.
We recommend [Microsoft Visual Studio Code](https://code.visualstudio.com/), as setup instructions will be provided for VS Code.

#### Node.js Installation

We use Node.js as are core framework.

If you do not have Node, please download it [here](https://nodejs.org/en/download/).

Head to the downloads section and install the LTS version on Node on your computer.
Below is an example of the download selection.

![](https://i.imgur.com/dZbTENj.png)

#### Repository Cloning

Use your preferred git tool or follow [these](https://help.github.com/en/github/creating-cloning-and-archiving-repositories/cloning-a-repository) instructions to clone a copy of this repository to your machine.

#### Package Installation

Once you have cloned our repo, the first step to set up a development environment is to first install package dependencies. The easiest way to do this is to use npm.

1. Open Visual Studio Code (VSC)
 - Once you have VSC opened, press <i>Ctrl + O</i> to open a file.
 - Locate and select the <i>COMP-2800-TEAM-DTC-11-Covid-Royale</i> folder.

 You should now have our code displayed on your IDE.

2. Open Command Line (CMD/Terminal)
 - Press <i>Ctrl + Shift + `</i> to open up the VSC terminal window.
 - If your terminal is not yet redirected to the repo folder, you can do so by using the ``cd`` command. More information on this can be found [here.](https://www.minitool.com/news/how-to-change-directory-in-cmd.html)

 VSC built-in terminal window should display at the bottom of it's IDE.

3. Install packages
 - In your terminal window, type ``npm install``

 - A message similar to the image below should display in the chat after waiting a few seconds to display that you have successfully installed all required packages.

 ![npm results](https://i.imgur.com/OueQM4T.png)

#### Environment Variable Setup

For simplicity sake, we have included our .env file as an example, and you may connect to our backend.

If you would like to use you own mongoDB instance:

- Rename the file called SAMPLE_env to ".env", and populate it with your own values.

 - mongoURI from your mongoDB atlas cluster
 - clientID and clientSecret from google developers console
 - finally the field "cookieKey" is decided by YOU, it just has to be a string that you keep secret!

![env](https://i.imgur.com/yO7cBPq.png)

#### Running the Server

From here the core file to run is ``server.js``

  - In your terminal window, in root <i>COMP-2800-TEAM-DTC-11-Covid-Royale</i>>     type ``npm start``

  - Alternatively for development we have used [Nodemon](https://www.npmjs.com/package/nodemon)                                  type ``npm run dev``

  - If the server loading is successful, you will see a message like the image below.

    ![Server running](https://i.imgur.com/HKLvPGf.png "Server Running")

-  Open your browser of choice, navigate to ``localhost:8080`` , you should now see a fully functional webpage. You now have a development environment for you to play around with!

## File Structure

![directory](https://i.imgur.com/zL1oyWN.png)

**server.js**

- Core js file, this controls all client traffic, game restarts, database querying. This file should be run to start.

**"public" folder**

- Contains all outward facing files, client accessible files.

   **"assets" folder**

   - Contains loadable content, eg images, audio

      **"audio" folder**

      - Contains sound effects and music for the application.

      **"bitmapFont" folder**

      - Contains bitmap font images to be used within the game.

      **"favicon" folder**

      - Contains assets for html page favicon's

      **"img" folder**

      - Contains image assets for the webpage and game tilesheets/sprites.

      **"maps" folder**

      - Contains .tmx and .json files that are imported into phaser as game maps.

   **"css" folder**

   - Contains css styling for homepage. > *index.html*

   **"js" folder**

   - Contains files for core boot up of game application. > *main.js*

   **"scenes" folder**

   - Contains scene files for the game. 
   - These are scene classes to extend Phaser 3 scenes.
   - *LoadScene.js* loads in majority of game assets.
   - *GameScene.js* is core game code.
   - *GameUI.js* contains the Game UI code for the game.
   - *GameVirtualController.js* contains the game's Virtual Controller code.
   - *PostRoundScene.js* contains the Leaderboard display and end of game code.

   **game.html**

   - html file to boot *main.js*. Serves as a holder for the game canvas.

   **index.html**

   - landing page for the application

**"routes" folder**

- *auth-routes.js* contains the logic needed for passport authentication via Google OAuth.

## Testing

[Testing spreadsheet can be found here.](https://docs.google.com/spreadsheets/d/1Uznlux2gQFMmMrv-HQ4WFVlykO0msHPVcktTSyNpGcA/edit#gid=394496370)

## Resources

#### Frameworks

- [Node.js](https://nodejs.org/en/) - Core framework, application is written in Node.js
- [Express.io](https://expressjs.com/) - Common Node.js Server framework extension
- [Phaser 3](https://photonstorm.github.io/phaser3-docs/) - Open Source HTML5 game framework, used to generate the game.

#### APIs

- [Socket.io](https://socket.io/) - Used for Server to Client Websocketing. Things like players locations are emitted to the Server, and then broadcast to all other Clients connected to update X and Y co-ordinates. Socket.io handles this.
- [MongoDB](https://www.mongodb.com/) - Used to store persistent information, sessions, users and user data.

#### Middleware

- [Passport](http://www.passportjs.org/) - For OAuth user Authentication, the application specifically uses the Google strategy. 

#### Applications

- [Shoebox](https://renderhjs.net/shoebox/) - Used for sprite packing and sprite animation stripping.
- [Tiled](https://www.mapeditor.org/) - Used for Tile mapping and generating our map layouts.
- [tile-extruder](https://github.com/sporadic-labs/tile-extruder) - To extrude tile maps to remove the dreaded "Tile-bleed" effect

#### Graphics

**Sprites / Tilesheets**

This game uses sprites from https://opengameart.org/

- [Zelda-like tilesets and sprites](https://opengameart.org/content/zelda-like-tilesets-and-sprites) - Used for game map, character, and game objects.

**BitmapFont**

- [Retro-Font](https://www.dafont.com/retro-gaming.font) - Used for player Nameplate text, UI text and Post-Round text. BitmapFonts are needed specifically for pixel games as smoothing looks poor on low pixel numbers.

#### Audio

**Sound effects**

This game uses these sounds from [Freesound](https://freesound.org/):

- Pickup sound #1 by [TheDweebMan](https://freesound.org/people/TheDweebMan/sounds/277215/)

- Pickup sound #2 by [ProjectsU012](https://freesound.org/people/ProjectsU012/sounds/341695/)
- Sneeze sound by [joedeshon](https://freesound.org/people/joedeshon/sounds/266019/)
- Cough sound by [InsepectorJ](https://freesound.org/people/InspectorJ/sounds/368802/)

**Background music**

Royalty free music from https://www.fesliyanstudios.com

- ["A Bit Of Hope" by David Fesliyan](https://www.fesliyanstudios.com/royalty-free-music/download/a-bit-of-hope/565)